# CLI Документация

## Установка

```bash
# Сборка из исходников
cd cmd/cli
go build -o ipset-cli
sudo mv ipset-cli /usr/local/bin/

# Настройка автодополнения
ipset-cli completion bash > /etc/bash_completion.d/ipset-cli
```

## Конфигурация

```bash
# Просмотр конфигурации
ipset-cli config view

# Установка URL API
ipset-cli config set api_url http://localhost:8080

# Установка формата вывода по умолчанию
ipset-cli config set output table

# Установка токена вручную
ipset-cli config set token your-jwt-token
```

## Аутентификация

```bash
# Логин с API ключом
ipset-cli login your-api-key

# Токен автоматически сохранится в конфиг
```

## Управление записями

### Создание записи

```bash
# Базовая запись
ipset-cli records create \
  --set-name webservers \
  --ip 192.168.1.100 \
  --context "production"

# Полная запись с портом и протоколом
ipset-cli records create \
  --set-name webservers \
  --ip 192.168.1.100 \
  --cidr 32 \
  --port 80 \
  --protocol tcp \
  --description "Web server" \
  --context "production"
```

### Просмотр записей

```bash
# Все записи
ipset-cli records list

# Конкретная запись
ipset-cli records get 100001

# В разных форматах
ipset-cli --output json records list
ipset-cli --output yaml records list
```

### Обновление записи

```bash
ipset-cli records update 100001 \
  --description "Updated web server" \
  --port 443
```

### Удаление записи

```bash
ipset-cli records delete 100001
```

### Поиск

```bash
ipset-cli records search "production"
```
## Управление сетами

### Список сетов

```bash
ipset-cli sets list
```

### Просмотр сета

```bash
ipset-cli sets get webservers
```

### Экспорт сета

```bash
# В ipset формат
ipset-cli sets export webservers > webservers.rules

# В JSON
ipset-cli sets export webservers --format json

# Применить правила
ipset-cli sets export webservers | bash
```

### Удаление сета

```bash
ipset-cli sets delete webservers
```

### Импорт правил

#### Из файла

```bash
# Импорт из файла
ipset-cli import file /etc/ipset

# С префиксом контекста
ipset-cli import file backup.rules --context-prefix backup

# Просмотр без импорта
ipset-cli import file /etc/ipset --dry-run
```
#### Из /etc/ipset

```bash
ipset-cli import etc
```

#### Из stdin

```bash
cat /etc/ipset | ipset-cli import stdin
ipset save | ipset-cli import stdin
```

#### Из работающей системы

```bash
# Все сеты
ipset-cli import system

# Конкретный сет
ipset-cli import system webservers
```

#### Из всех источников
```bash
ipset-cli import all
```

### Экспорт правил

#### Экспорт записей

```bash
# Все записи
ipset-cli export > all_rules.sh

# Конкретная запись
ipset-cli export 100001
```

#### Форматы вывода

```bash
# Табличный (по умолчанию)
ipset-cli records list

# JSON
ipset-cli --output json records list

# YAML
ipset-cli --output yaml records list

# IPSet правила
ipset-cli --output ipset records list
```
#### Примеры вывода

##### Табличный вывод
```text
$ ipset-cli records list
┌────────┬───────────────┬───────────────┬──────┬──────┬──────────┬─────────────────┬────────────────┬────────────┐
│  ID    │ Set Name      │ IP            │ CIDR │ Port │ Protocol │ Description     │ Context        │ Created    │
├────────┼───────────────┼───────────────┼──────┼──────┼──────────┼─────────────────┼────────────────┼────────────┤
│ 100001 │ webservers    │ 192.168.1.100 │ 32   │ 80   │ tcp      │ Web server      │ production     │ 2024-01-15 │
│ 100002 │ databases     │ 10.0.0.5      │      │ 3306 │ tcp      │ MySQL server    │ production     │ 2024-01-15 │
└────────┴───────────────┴───────────────┴──────┴──────┴──────────┴─────────────────┴────────────────┴────────────┘
```

##### JSON вывод
```json
[
  {
    "id": 100001,
    "set_name": "webservers",
    "ip": "192.168.1.100",
    "cidr": "32",
    "port": 80,
    "protocol": "tcp",
    "description": "Web server",
    "context": "production",
    "created_at": "2024-01-15T10:00:00Z"
  }
]
```

##### IPSet вывод

```bash
#!/bin/bash
# IPSet rules generated by ipset-cli

# Create set: webservers
ipset create webservers hash:ip,port -exist

# Rule ID: 100001 - Web server
ipset add webservers 192.168.1.100/32,tcp:80 -exist

# Example iptables rules:
# iptables -A INPUT -m set --match-set webservers src -j ACCEPT
```